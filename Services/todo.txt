move the logic from the controllers here